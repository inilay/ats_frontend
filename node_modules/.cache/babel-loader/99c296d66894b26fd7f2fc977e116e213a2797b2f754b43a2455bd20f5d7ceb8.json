{"ast":null,"code":"var _s = $RefreshSig$();\nimport axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\nimport dayjs from \"dayjs\";\nimport { useContext } from \"react\";\nimport { AuthContext } from \"../context\";\nconst baseURL = \"http://127.0.0.1:8000/api/v1\";\nconst useAxios = () => {\n  _s();\n  const {\n    authTokens,\n    setUser,\n    setAuthTokens\n  } = useContext(AuthContext);\n  const axiosInstance = axios.create({\n    baseURL,\n    headers: {\n      Authorization: `Bearer ${authTokens === null || authTokens === void 0 ? void 0 : authTokens.access}`\n    }\n  });\n  axiosInstance.interceptors.request.use(async req => {\n    const user = jwt_decode(authTokens.access);\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n    if (!isExpired) return req;\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\n      refresh: authTokens.refresh\n    });\n    localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\n    setAuthTokens(response.data);\n    setUser(jwt_decode(response.data.access));\n    req.headers.Authorization = `Bearer ${response.data.access}`;\n    return req;\n  });\n  return axiosInstance;\n};\n_s(useAxios, \"BY8wXILb98JGRtiYNfD1oywxzJ4=\");\nexport default useAxios;","map":{"version":3,"names":["axios","jwt_decode","dayjs","useContext","AuthContext","baseURL","useAxios","authTokens","setUser","setAuthTokens","axiosInstance","create","headers","Authorization","access","interceptors","request","use","req","user","isExpired","unix","exp","diff","response","post","refresh","localStorage","setItem","JSON","stringify","data"],"sources":["/home/indiora/ATS/frontend/src/API/useAxios.js"],"sourcesContent":["import axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\nimport dayjs from \"dayjs\";\nimport { useContext } from \"react\";\nimport { AuthContext } from \"../context\";\n\nconst baseURL = \"http://127.0.0.1:8000/api/v1\";\n\nconst useAxios = () => {\n    const { authTokens, setUser, setAuthTokens } = useContext(AuthContext);\n\n    const axiosInstance = axios.create({\n        baseURL,\n        headers: { Authorization: `Bearer ${authTokens?.access}` },\n    });\n\n    axiosInstance.interceptors.request.use(async (req) => {\n        const user = jwt_decode(authTokens.access);\n        const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n\n        if (!isExpired) return req;\n\n        const response = await axios.post(`${baseURL}/token/refresh/`, {\n            refresh: authTokens.refresh,\n        });\n\n        localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\n\n        setAuthTokens(response.data);\n        setUser(jwt_decode(response.data.access));\n\n        req.headers.Authorization = `Bearer ${response.data.access}`;\n        return req;\n    });\n\n    return axiosInstance;\n};\n\nexport default useAxios;\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,UAAU,QAAQ,OAAO;AAClC,SAASC,WAAW,QAAQ,YAAY;AAExC,MAAMC,OAAO,GAAG,8BAA8B;AAE9C,MAAMC,QAAQ,GAAG,MAAM;EAAA;EACnB,MAAM;IAAEC,UAAU;IAAEC,OAAO;IAAEC;EAAc,CAAC,GAAGN,UAAU,CAACC,WAAW,CAAC;EAEtE,MAAMM,aAAa,GAAGV,KAAK,CAACW,MAAM,CAAC;IAC/BN,OAAO;IACPO,OAAO,EAAE;MAAEC,aAAa,EAAG,UAASN,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEO,MAAO;IAAE;EAC7D,CAAC,CAAC;EAEFJ,aAAa,CAACK,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,MAAOC,GAAG,IAAK;IAClD,MAAMC,IAAI,GAAGlB,UAAU,CAACM,UAAU,CAACO,MAAM,CAAC;IAC1C,MAAMM,SAAS,GAAGlB,KAAK,CAACmB,IAAI,CAACF,IAAI,CAACG,GAAG,CAAC,CAACC,IAAI,CAACrB,KAAK,EAAE,CAAC,GAAG,CAAC;IAExD,IAAI,CAACkB,SAAS,EAAE,OAAOF,GAAG;IAE1B,MAAMM,QAAQ,GAAG,MAAMxB,KAAK,CAACyB,IAAI,CAAE,GAAEpB,OAAQ,iBAAgB,EAAE;MAC3DqB,OAAO,EAAEnB,UAAU,CAACmB;IACxB,CAAC,CAAC;IAEFC,YAAY,CAACC,OAAO,CAAC,YAAY,EAAEC,IAAI,CAACC,SAAS,CAACN,QAAQ,CAACO,IAAI,CAAC,CAAC;IAEjEtB,aAAa,CAACe,QAAQ,CAACO,IAAI,CAAC;IAC5BvB,OAAO,CAACP,UAAU,CAACuB,QAAQ,CAACO,IAAI,CAACjB,MAAM,CAAC,CAAC;IAEzCI,GAAG,CAACN,OAAO,CAACC,aAAa,GAAI,UAASW,QAAQ,CAACO,IAAI,CAACjB,MAAO,EAAC;IAC5D,OAAOI,GAAG;EACd,CAAC,CAAC;EAEF,OAAOR,aAAa;AACxB,CAAC;AAAC,GA5BIJ,QAAQ;AA8Bd,eAAeA,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}